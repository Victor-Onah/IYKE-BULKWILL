(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{577:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return s(486)}])},486:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSG:function(){return u},default:function(){return AdminDashboard}});var a=s(5893),l=s(7294),i=s(1664),n=s.n(i),r=s(2684),c=s(5675),d=s.n(c),o=s(9008),x=s.n(o),u=!0;function AdminDashboard(e){let{authToken:t,apiAuthToken:s}=e,[i,c]=(0,l.useState)(!1),[o,u]=(0,l.useState)(null),[m,h]=(0,l.useState)(null),[p,f]=(0,l.useState)(),[g,b]=(0,l.useState)("pending"),[j,v]=(0,l.useState)([]),[w,N]=(0,l.useState)(),[y,k]=(0,l.useState)("pending"),[A,C]=(0,l.useState)(),[z,S]=(0,l.useState)("pending"),[P,_]=(0,l.useState)(!1);async function uploadProduct(e){e.preventDefault();let a=document.getElementById("product-name"),l=document.getElementById("product-category"),i=document.getElementById("product-image"),n=document.getElementById("submit-btn"),r=a.value.trim(),d=l.value.trim(),o=i.files?i.files[0]:null;if(!o)return alert("Please select an image");n.setAttribute("disabled","true"),n.textContent="Please wait...";let x=new FormData;x.append("productName",r),x.append("productImage",o),x.append("productCategory",d);try{let e=await fetch("/api/admin/upload",{method:"POST",body:x,headers:{"X-Admin-Authorization-Token":t,"X-Application-Authorization-Token":s}});if(!(e=await e.json()).success)return n.removeAttribute("disabled"),n.textContent="Finish",alert("Failed to complete request.");alert("Product upload was successful!"),u(void 0),c(!1),h(null)}catch(e){console.error(e),alert("Failed to complete request."),n.removeAttribute("disabled"),n.textContent="Finish"}}async function loadProducts(){b("pending");try{let e=await fetch("/api/listings?page=1&all=".concat(!0),{headers:{"x-application-authorization-token":s}});return e=await e.json(),b("success"),e.reverse()}catch(e){return b("failed"),[]}}async function selectItem(e){e.target.checked?v(t=>(console.log(e.target.id),[...t,e.target.id])):v(t=>t.filter(t=>t!==e.target.id))}async function deleteProducts(e){if(e.preventDefault(),confirm("You are about to delete ".concat(j.length," products, do you wish to continue?"))){let e=document.getElementById("submit-btn");try{null==e||e.setAttribute("disabled","true"),e.textContent="Please wait...";let a=await fetch("/api/admin/delete",{method:"DELETE",body:JSON.stringify(j),headers:{"X-Admin-Authorization-Token":t,"X-Application-Authorization-Token":s,"Content-Type":"application/json"}});if(!(a=await a.json()).success)return null==e||e.removeAttribute("disabled"),e.textContent="Delete all",alert("Failed to complete request. Please try again.");alert("Products deleted successfully!"),v([]),u(void 0),c(!1)}catch(t){console.error(t),alert("Failed to complete request. Please try again."),null==e||e.removeAttribute("disabled"),e.textContent="Delete all"}}}async function loadMessages(){k("pending");try{let e=await fetch("/api/admin/messages",{headers:{"X-Admin-Authorization-Token":t,"x-application-authorization-token":s}});return e=await e.json(),k("success"),e.reverse()}catch(e){return console.error(e),k("failed"),[]}}async function markMessageAsReplied(e){e.target.setAttribute("disabled","true"),e.target.textContent="Please wait...";try{let a=await fetch("/api/admin/messages/mark/".concat(e.target.dataset.id),{method:"PATCH",headers:{"X-Admin-Authorization-Token":t,"x-application-authorization-token":s}});if((a=await a.json()).success){let t=[...w];t[w.findIndex(t=>t._id===e.target.dataset.id)].replied="yes",N(t)}else alert("Failed to complete request"),e.target.removeAttribute("disabled"),e.target.textContent="Mark as replied"}catch(t){console.error(t),alert("Failed to complete request"),e.target.removeAttribute("disabled"),e.target.textContent="Mark as replied"}}async function loadOrders(){S("pending");try{let e=await fetch("/api/admin/orders",{headers:{"X-Admin-Authorization-Token":t,"x-application-authorization-token":s}});return e=await e.json(),S("success"),e.reverse()}catch(e){return console.error(e),S("failed"),[]}}async function markOrderAsCompleted(e){e.target.setAttribute("disabled","true"),e.target.textContent="Please wait...";try{let a=await fetch("/api/admin/orders/mark/".concat(e.target.dataset.id),{method:"PATCH",headers:{"X-Admin-Authorization-Token":t,"x-application-authorization-token":s}});if((a=await a.json()).success){let t=[...A];t[A.findIndex(t=>t._id===e.target.dataset.id)].completed="yes",C(t)}else alert("Failed to complete request"),e.target.removeAttribute("disabled"),e.target.textContent="Mark as completed"}catch(t){console.error(t),alert("Failed to complete request"),e.target.removeAttribute("disabled"),e.target.textContent="Mark as completed"}}async function authorizeAdmin(e){e.preventDefault();let a=document.getElementById("username"),l=document.getElementById("password"),i=document.getElementById("submit-btn");try{null==i||i.setAttribute("disabled","true"),i.textContent="Please wait...";let e=await fetch("/api/admin/authorize",{method:"POST",headers:{"X-Admin-Authorization-Token":t,"x-application-authorization-token":s,"Content-Type":"application/json"},body:JSON.stringify({username:null==a?void 0:a.value.trim(),password:null==l?void 0:l.value.trim()})});(e=await e.json()).success?_(!0):(alert("Incorrect login credentials. Please check the values and try again"),null==i||i.removeAttribute("disabled"),i.textContent="Submit")}catch(e){console.error(e),alert("Failed to complete request due unknown error."),null==i||i.removeAttribute("disabled"),i.textContent="Submit"}}return P?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x(),{children:(0,a.jsx)("title",{children:"Admin Dashboard"})}),(0,a.jsxs)("div",{className:"max-w-5xl mx-auto p-4 my-16",children:[(0,a.jsx)("h1",{className:"font-bold text-2xl text-zinc-500 mb-8",children:(0,a.jsx)(n(),{href:"/admin",children:"Admin Dashboard"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-semibold text-lg text-zinc-500 mb-4",children:"Welcome sir Iyke, what would you like to do?"}),(0,a.jsxs)("div",{className:"grid grid-cols-4 max-[1020px]:grid-cols-4 max-[768px]:grid-cols-3 max-[480px]:grid-cols-2 max-[250px]:grid-cols-1 gap-4",children:[(0,a.jsxs)("div",{onClick:()=>{c(!0),u("upload a product")},className:"bg-blue-700 text-white p-4 flex flex-col justify-center items-center gap-2 hover:shadow-2xl active:scale-95",children:[(0,a.jsx)(r.DUB,{}),(0,a.jsx)("h3",{className:"text-center",children:"Upload a product"})]}),(0,a.jsxs)("div",{onClick:async()=>{c(!0),f(await loadProducts()),u("delete products")},className:"bg-red-700 text-white p-4 flex flex-col justify-center items-center gap-2 hover:shadow-2xl active:scale-95",children:[(0,a.jsx)(r.Z2m,{}),(0,a.jsx)("h3",{className:"text-center",children:"Delete products"})]}),(0,a.jsxs)("div",{onClick:async()=>{c(!0),N(await loadMessages()),u("view messages")},className:"bg-green-700 text-white p-4 flex flex-col justify-center items-center gap-2 hover:shadow-2xl active:scale-95",children:[(0,a.jsx)(r.TpC,{}),(0,a.jsx)("h3",{className:"text-center",children:"View messages"})]}),(0,a.jsxs)("div",{onClick:async()=>{c(!0),C(await loadOrders()),u("view orders")},className:"bg-yellow-700 text-white p-4 flex flex-col justify-center items-center gap-2 hover:shadow-2xl active:scale-95",children:[(0,a.jsx)(r.rI6,{}),(0,a.jsx)("h3",{className:"text-center",children:"View orders"})]}),(0,a.jsxs)("div",{onClick:async()=>{c(!0),u(void 0),f(await loadProducts())},className:"bg-purple-700 text-white p-4 flex flex-col justify-center items-center gap-2 hover:shadow-2xl active:scale-95",children:[(0,a.jsx)(r.rI6,{}),(0,a.jsx)("h3",{className:"text-center",children:"View all products"})]})]})]}),i&&(0,a.jsx)("div",{className:"fixed top-0 bottom-0 z-[1000] h-full left-0 w-full flex justify-center items-center p-4",style:{backdropFilter:"blur(15px)"},children:(0,a.jsxs)("div",{className:"relative min-h-[250px] max-h-full w-full max-w-[600px] bg-white will-change overflow-hidden",children:[(0,a.jsx)("span",{onClick:()=>{c(!1),v([]),u(void 0),h(null)},className:"absolute top-2 right-2 w-8 h-8 flex justify-center items-center rounded-full bg-slate-200 active:bg-slate-400 shadow-lg",children:(0,a.jsx)(r.JqX,{})}),"upload a product"===o?(0,a.jsx)("div",{children:(0,a.jsxs)("form",{onSubmit:uploadProduct,className:"p-4 flex flex-col gap-2 w-full max-w-[400px] mx-auto",children:[(0,a.jsx)("h4",{className:"text-lg text-zinc-600 text-center mb-4 font-semibold",children:"Upload Product"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm text-zinc-700 block",htmlFor:"product-name",children:"Product name"}),(0,a.jsx)("input",{required:!0,className:"outline-none focus:outline-none focus:border-blue-700 border-2 min-w-0 rounded border-zinc-500 w-full px-2 py-1",id:"product-name",placeholder:"Product name",type:"text"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm text-zinc-700 block",htmlFor:"product-category",children:"Category"}),(0,a.jsxs)("select",{defaultValue:"",required:!0,className:"w-full px-2 py-1 bg-slate-100 active:bg-slate-200 rounded",name:"product-category",id:"product-category",children:[(0,a.jsx)("option",{value:"solar panels",children:"Solar Panels"}),(0,a.jsx)("option",{value:"cctvs",children:"CCTVs"}),(0,a.jsx)("option",{value:"security lights",children:"Security Lights"}),(0,a.jsx)("option",{value:"phones",children:"Phones"}),(0,a.jsx)("option",{value:"laptops",children:"Laptops"}),(0,a.jsx)("option",{value:"home lights",children:"Home Lights"}),(0,a.jsx)("option",{value:"real estate",children:"Real Estate"})]})]}),(0,a.jsxs)("div",{onClick:e=>{var t;null===(t=e.currentTarget.querySelector("input"))||void 0===t||t.click()},className:"relative p-4 bg-blue-700 text-white flex text-center gap-2 justify-center items-center max-w-[250px] active:scale-95",children:[(0,a.jsx)("input",{required:!0,id:"product-image",onChange:e=>h(e.target.files?e.target.files[0].name:null),type:"file",accept:"image/*",className:"w-0 h-0 absolute"}),(0,a.jsx)(r.DUB,{}),(0,a.jsx)("p",{children:"Upload product image"})]}),m&&(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(r.H3h,{})," ",m]}),(0,a.jsx)("button",{id:"submit-btn",className:"border-2 border-blue-700 rounded-full px-4 py-2 text-blue-700 hover:bg-blue-700 hover:text-white active:scale-95 font-bold disabled:bg-blue-700 disabled:text-white disabled:opacity-70",type:"submit",children:"Finish"})]})}):"delete products"===o?(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h4",{className:"text-lg text-center mb-4 font-semibold text-zinc-600",children:"Delete Products"}),(0,a.jsx)("div",{className:"pt-8 flex flex-col gap-2 relative",children:"pending"===g?(0,a.jsx)("h5",{className:"text-zinc-400 text-center text-semibold",children:"Loading products..."}):"failed"===g?(0,a.jsx)("h5",{className:"text-zinc-400 text-center text-semibold",children:"Failed to load products"}):p.length<1?(0,a.jsx)("h5",{className:"text-zinc-400 text-center text-semibold",children:"No products to show"}):(0,a.jsxs)("form",{className:"overflow-hidden grid relative",onSubmit:deleteProducts,children:[(0,a.jsx)("div",{className:"max-h-[55vh] overflow-auto mb-16 flex flex-col gap-2",children:p.map(e=>(0,a.jsxs)("div",{className:"flex gap-2 justify-start items-center bg-slate-100 rounded p-2 active:scale-95",children:[(0,a.jsx)("input",{onChange:selectItem,type:"checkbox",id:e._id}),(0,a.jsx)(d(),{className:"h-50 aspect-square rounded-full",src:e.imageUrl,alt:e.name,height:50,width:50}),(0,a.jsx)("label",{className:"flex-grow flex-shrink text-sm",htmlFor:e._id,children:e.name})]},e._id))}),j.length>0&&(0,a.jsx)("button",{id:"submit-btn",className:"bg-red-700 text-white px-4 py-2 rounded w-full absolute bottom-4 disabled:opacity-75",type:"submit",children:"Delete all"})]})})]}):"view messages"===o?(0,a.jsxs)("div",{className:"p-4 overflow-hidden",children:[(0,a.jsx)("h4",{className:"text-lg text-center mb-4 font-semibold text-zinc-600",children:"Messages"}),(0,a.jsx)("div",{className:"flex flex-col gap-2 max-h-[70vh] overflow-scroll",children:"pending"===y?(0,a.jsx)("h5",{className:"text-zinc-400 text-center text-semibold",children:"Loading messages..."}):"failed"===y?(0,a.jsx)("h5",{className:"text-zinc-400 text-center text-semibold",children:"Failed to load messages"}):w.length<1?(0,a.jsx)("h5",{className:"text-zinc-400 text-center text-semibold",children:"No messages to show"}):(0,a.jsx)("div",{className:"flex flex-col gap-2",children:w.map(e=>(0,a.jsxs)("div",{className:"bg-slate-50 rounded-lg p-2 flex flex-col gap-2 hover:shadow-lg",children:[(0,a.jsx)("h5",{className:"text-sm font-bold",children:e.name}),(0,a.jsx)("p",{children:e.message}),(0,a.jsxs)("div",{className:"text-sm flex justify-center items-center",children:[(0,a.jsxs)("a",{className:"flex gap-2 bg-blue-50 text-blue-700 rounded-full px-2 py-1 items-center active:scale-95",href:"mailto:".concat(e.email),children:[(0,a.jsx)(r.SRX,{})," Email"]}),(0,a.jsxs)("a",{className:"flex gap-2 bg-blue-50 text-blue-700 rounded-full px-2 py-1 items-center active:scale-95",href:"tel:".concat(e.phoneNumber),children:[(0,a.jsx)(r.I7T,{})," Call"]})]}),"yes"===e.replied?(0,a.jsxs)("p",{className:"text-[10px] flex justify-end items-center gap-2 text-blue-700",children:[(0,a.jsx)(r.W_7,{})," Replied"]}):(0,a.jsx)("button",{onClick:markMessageAsReplied,"data-id":e._id,className:"px-2 py-1 text-sm bg-blue-700 text-white rounded full w-full active:scale-95 disabled:opacity-75",children:"Mark as replied"})]},e._id))})})]}):"view orders"===o?(0,a.jsxs)("div",{className:"p-4 overflow-hidden",children:[(0,a.jsx)("h4",{className:"text-lg text-center mb-4 font-semibold text-zinc-600",children:"Orders"}),(0,a.jsx)("div",{className:"flex flex-col gap-2 max-h-[70vh] overflow-scroll",children:"pending"===z?(0,a.jsx)("h5",{className:"text-zinc-400 text-center text-semibold",children:"Loading orders..."}):"failed"===z?(0,a.jsx)("h5",{className:"text-zinc-400 text-center text-semibold",children:"Failed to orders"}):A.length<1?(0,a.jsx)("h5",{className:"text-zinc-400 text-center text-semibold",children:"No orders to show"}):(0,a.jsx)("div",{className:"flex flex-col gap-2",children:A.map(e=>(0,a.jsxs)("div",{className:"bg-slate-50 rounded-lg p-2 flex flex-col gap-2 hover:shadow-lg",children:[(0,a.jsx)("h5",{className:"text-lg font-bold",children:e.customerContact[0]}),(0,a.jsx)("p",{className:"text-sm",children:new Date(e.dateCreated).toDateString()}),(0,a.jsxs)("div",{className:"text-sm flex flex-col gap-2",children:[(0,a.jsx)("h6",{className:"text-center font-bold text-zinc-600",children:"Order Summary"}),(0,a.jsx)("div",{className:"flex flex-col gap-2",children:e.products.map(e=>(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(d(),{className:"aspect-square rounded-full h-50 w-50",height:50,width:50,src:e.imageUrl,alt:e.name}),(0,a.jsx)("p",{className:"font-semibold",children:e.name}),(0,a.jsxs)("small",{className:"font-bold",children:["(",e.quantity,")"]})]}))}),(0,a.jsxs)("div",{className:"text-sm flex justify-center items-center",children:[(0,a.jsxs)("a",{className:"flex gap-2 bg-blue-50 text-blue-700 rounded-full px-2 py-1 items-center active:scale-95",href:"mailto:".concat(e.customerContact[0]),children:[(0,a.jsx)(r.SRX,{})," Email"]}),(0,a.jsxs)("a",{className:"flex gap-2 bg-blue-50 text-blue-700 rounded-full px-2 py-1 items-center active:scale-95",href:"tel:".concat(e.customerContact[2]),children:[(0,a.jsx)(r.I7T,{})," Call"]})]})]}),"yes"===e.completed?(0,a.jsxs)("p",{className:"text-[10px] flex justify-end items-center gap-2 text-blue-700",children:[(0,a.jsx)(r.W_7,{})," Completed"]}):(0,a.jsx)("button",{onClick:markOrderAsCompleted,"data-id":e._id,className:"px-2 py-1 text-sm bg-blue-700 text-white rounded full w-full active:scale-95 disabled:opacity-75",children:"Mark as completed"})]},e._id))})})]}):(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h4",{className:"text-lg text-center mb-4 font-semibold text-zinc-600",children:"Products"}),(0,a.jsx)("div",{className:"pt-8 flex flex-col gap-2 relative",children:"pending"===g?(0,a.jsx)("h5",{className:"text-zinc-400 text-center text-semibold",children:"Loading products..."}):"failed"===g?(0,a.jsx)("h5",{className:"text-zinc-400 text-center text-semibold",children:"Failed to load products"}):p.length<1?(0,a.jsx)("h5",{className:"text-zinc-400 text-center text-semibold",children:"No products to show"}):(0,a.jsx)("div",{className:"overflow-hidden grid relative",children:(0,a.jsx)("div",{className:"max-h-[55vh] overflow-auto mb-16 flex flex-col gap-2",children:p.map(e=>(0,a.jsxs)("div",{className:"flex gap-2 justify-start items-center bg-slate-100 rounded p-2 active:scale-95",children:[(0,a.jsx)(d(),{className:"h-50 aspect-square rounded-full",src:e.imageUrl,alt:e.name,height:50,width:50}),(0,a.jsx)("p",{className:"flex-grow flex-shrink text-sm",htmlFor:e._id,children:e.name})]},e._id))})})})]})]})})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x(),{children:(0,a.jsx)("title",{children:"Admin Login"})}),(0,a.jsx)("div",{className:"min-h-[100vh] flex justify-center items-center p-4",children:(0,a.jsxs)("form",{onSubmit:authorizeAdmin,className:"flex flex-col gap-2 p-4 rounded shadow-lg",children:[(0,a.jsx)("h2",{className:"font-2xl text-center font-bold text-zinc-600",children:"Authorization Form"}),(0,a.jsx)("p",{className:"font-lg font-semibold text-center text-zinc-600",children:"Please enter the correct information to continue"}),(0,a.jsx)("input",{id:"username",className:"p-2 rounded border-2 border-zinc-700",placeholder:"Admin username",required:!0,type:"text"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{id:"password",className:"p-2 rounded border-2 border-zinc-700 w-full",placeholder:"Admin password",required:!0,type:"password"}),(0,a.jsx)("small",{onClick:e=>{let{currentTarget:t}=e,s=t.previousElementSibling;"password"===s.type?(s.setAttribute("type","text"),t.textContent="Hide"):(s.setAttribute("type","password"),t.textContent="Show")},className:"text-[8px] absolute right-2 top-1/2 -translate-y-1/2 font-extrabold cursor-pointer",children:"Show"})]}),(0,a.jsx)("button",{id:"submit-btn",className:"bg-blue-700 text-white disabled:opacity-75 active:scale-95 px-4 py-2 rounded",type:"submit",children:"Submit"})]})})]})}}},function(e){e.O(0,[959,774,888,179],function(){return e(e.s=577)}),_N_E=e.O()}]);